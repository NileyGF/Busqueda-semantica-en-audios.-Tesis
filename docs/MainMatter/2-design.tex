\section{Modelación y diseño}
\label{sec:design}
El primer paso es definir qué método utilizar para obtener una representación de la música que pueda ser utilizada para recuperación semántica con consultas textuales.
\subsection{Dataset}
\label{subsec:dataset}
% El sistema de validación de modelos para un VRP específico está basado en la estrategia de unidades de pruebas descrita en la sección \ref{sec:unitTesting}. Sin embargo, a diferencia del objetivo de las unidades de prueba, donde se desea comprobar la correctitud de un fragmento de código, en este trabajo se desea verificar si un modelo de optimización matemático para un VRP determinado refleja todas las características del mismo. Para ello se generan soluciones que cumplan o incumplan las características del problema y se evalúan en las restricciones del modelo. Si los resultados de la evaluación son satisfactorios, entonces parece que el modelo está correcto; de lo contrario, es posible asegurar que existe algún error en el mismo.

% El sistema de validación está compuesto por cuatro componentes: el {\it generador de soluciones de alto nivel}, el {\it generador de soluciones de bajo nivel}, el {\it generador de funciones} y el {\it evaluador del modelo} como se muestra en la figura \ref{fig:system}.

% \begin{figure}[htb]
% 	\centering
% 	\includegraphics[width=0.75\textwidth]{MainMatter/images/system.png}
% 	\caption{Componentes del sistema propuesto en este trabajo.} \label{fig:system}
% \end{figure}

% En este capítulo se describirán las entradas del sistema y cada uno de los componentes mencionados, haciendo énfasis en el funcionamiento de cada uno. Además, se presentará un ejemplo con el cual se guiará la explicación. A continuación se describen las entradas del sistema: la descripción del VRP y el modelo para ese problema.

% \section{Entradas del sistema}\label{sec:inputs}
% El objetivo de la herramienta implementada es determinar si un modelo matemático de un VRP es correcto o no. Para ello, es necesario escribir el modelo en el lenguaje LMML y realizar una descripción del VRP que se desea modelar. Esta descripción se realiza a través de las características abstractas del problema presentadas en la sección siguiente.

% \subsection{Características abstractas}

% Los VRP se describen a través de un conjunto de características a las que se hará referencia en este trabajo como \emph{características abstractas}. Estas se refieren a las restricciones que la solución de un VRP debe satisfacer y que están definidas en términos de los elementos de un VRP (clientes, rutas, depósitos, etc.).

% Por ejemplo, el CVRP se define por el siguiente conjunto de características abstractas:

% \begin{enumerate}
% 	\item Los clientes deben ser visitados solo una vez.
% 	\item Las rutas deben comenzar y terminar en el depósito central.
% 	\item La carga de los vehículos no debe exceder a su capacidad.
% \end{enumerate}

% Una vez que el VRP esté descrito mediante un conjunto de características abstractas $A$, se definirá el conjunto de todas las posibles biparticiones sobre $A$ como el conjunto de tuplas $B_A = \{(C_i, C_i^c), i = \overline{1, 2^{|A|}}\}$ donde $C_i$ es el $i$-ésimo subconjunto de $A$ y $C_i^c$ es su complemento.

% En el caso del CVRP el conjunto $B_A$ es el siguiente:

% $B_A=\{(\{\}, \{1, 2, 3\}), (\{1\}, \{2, 3\}),(\{2\}, \{1, 3\}), (\{3\}, \{1, 2\}), (\{1, 2\}, \{3\}),$\\$(\{2, 3\}, \{1\}), (\{1, 3\}, \{2\}), (\{1, 2, 3\}, \{\})\}$.

% Cada elemento de $B_A$ representa dos conjuntos que se usan en este trabajo para generar soluciones de alto nivel. Dichas soluciones deben cumplir con las características del primer conjunto e incumplir las del segundo. En la próxima sección se presenta el componente del sistema que realiza esta función: el generador de soluciones de alto nivel.

% \section{Generador de soluciones de alto nivel}\label{sec:first}
% El generador de soluciones de alto nivel se encarga de crear soluciones a partir de un conjunto de características que debe cumplir. Este conjunto será nombrado en este trabajo como requerimiento. A continuación se define el concepto de solución de alto nivel y después se describe la manera de definir el conjunto de requerimientos tomando como punto de partida las características del problema. Por último se muestra el funcionamiento de este componente. 

% \subsection{Soluciones de alto nivel}
% Las características abstractas describen las restricciones que las soluciones de un VRP deben satisfacer. Las \emph{soluciones de alto nivel} $\{S_i\}$ son soluciones que satisfacen las condiciones que impone cada elemento de $B_A$ y que están expresadas en función de los componentes del VRP. Por ejemplo, para las características abstractas del CVRP definidas en la sección anterior, se puede definir una solución de alto nivel con dos clientes, un vehículo y una ruta de la siguiente forma:

% \begin{center}
% 	{\it (depósito $\rightarrow$ cliente 1 $\rightarrow$ cliente 2 $\rightarrow$ depósito)}.
% \end{center}

% Sin embargo, estas soluciones de alto nivel se generan cumpliendo determinadas condiciones definidas a partir del conjunto de características abstractas del problema. En la sección siguiente se describe la definición de dichas condiciones.

% \subsection{Definición de los requerimientos}
% El sistema propuesto en este trabajo está basado en la metodología de unidades de prueba. El criterio de cobertura que se definió es el de cubrir los distintos escenarios de factibilidad e infactibilidad de las soluciones para el VRP deseado. A los efectos de esta investigación, cada elemento $(C_i, C_i^c)$ de $B_A$ determina un requerimiento, donde $C_i$ representa el conjunto de características abstractas que se deben satisfacer y $C_i^C$, el conjunto de características que no deben cumplirse. La pareja $(C_i, C_i^c)$ define las condiciones que se le imponen a las soluciones que se generan para cumplir cada requerimiento.

% A las soluciones generadas se les denomina \emph{subpruebas} y representan distintas situaciones en las que se cumplen las condiciones $(C_i, C_i^c)$. El cumplimiento de las condiciones puede realizarse de distintas maneras: se pueden generar soluciones {\bf extremas} donde un pequeño cambio de una solución a otra puede significar el incumplimiento de las condiciones; o crear soluciones {\bf holgadas} donde las condiciones se cumplan por un amplio margen con respecto a los casos en los que se incumplan; o construir soluciones intermedias donde algunas condiciones se cumplan de manera extrema y otras holgadas. Para el primer caso de cumplimiento de las condiciones se tienen como ejemplo soluciones con una única ruta o un solo cliente por ruta. El segundo caso puede lograrse, por ejemplo, con soluciones donde la capacidad máxima de los vehículos exceda a la suma de todas las demandas.

% Una vez definidos los requerimientos que debe cumplir cada solución de alto nivel, es posible presentar el funcionamiento del generador de soluciones de alto nivel.

% \subsection{Funcionamiento del componente}
% El generador de soluciones de alto nivel crea, para cada elemento $(C_i, C_i^c)$ de $B_A$, $k$ pares $\{(S_j, P_j), j=\overline{1,k})\}$ donde \(S_j\) es una solución de alto nivel para la instancia de problema $P_j$, y $S_j$ satisface todas las características abstractas presentes en $C_i$ e incumple todas las características que aparecen en $C_i^c$. El valor de $k$ lo elige el usuario, aunque debe ser lo suficientemente grande para abarcar un gran número de situaciones y lo suficientemente pequeño para que la generación no represente un gran costo computacional. En este trabajo se propone un valor por defecto de 10.

% Por ejemplo, el último elemento del conjunto $B_A$ $(\{1, 2, 3\}, \{\})$ definido en la sección \ref{sec:inputs} describe una solución factible donde las características 1, 2 y 3 del CVRP deben ser cumplidas y ninguna característica debe incumplirse. Para estas condiciones, el componente podría generar el problema y la solución de alto nivel mostrados en la figura \ref{fig:probSolEj}:

% \begin{figure}[h!]
% 	\begin{minipage}{0.45\textwidth}
% 		{\bf Problema}
		
% 		{\tt cantidad de clientes: 3\\capacidad: 3\\depósito: 0\\demandas: $\{1, 2, 1\}$}
% 	\end{minipage}
% 	\hfill
% 	\begin{minipage}{0.45\textwidth}
% 		{\bf Solución}
		
% 		{\tt rutas: $\{0, 1, 2, 0\}$ y $\{0, 3, 0\}$}
% 	\end{minipage}
% 	\caption{Problema y solución generada para el requerimiento $(\{1, 2, 3\}, \{\})$.} \label{fig:probSolEj}
% \end{figure}

% Las soluciones generadas por este componente se definen en función de las componentes de los VRP. Sin embargo, el modelo se define en función de variables, parámetros y conjuntos, por lo que es necesario transformar cada una de estas soluciones para que se puedan evaluar en las restricciones del modelo. A continuación se describe el componente en el que ocurre esta transformación: el generador de soluciones de bajo nivel.

% \section{Generador de soluciones de bajo nivel}\label{sec:second}

% Las \emph{soluciones de bajo nivel} son la representación de las soluciones de alto nivel en función de las variables, parámetros y conjuntos del modelo que se quiere validar. Para cada solución se genera un conjunto de instancias de variables $v_j$, de parámetros $p_j$ y de conjuntos $c_j$. El segundo componente del sistema propuesto transforma cada par $(S_j, P_j)$, generado por el primero, en soluciones de bajo nivel representadas por los conjuntos $v_j$, $p_j$ y $c_j$.

% Por ejemplo, si se quiere representar la solución de la figura \ref{fig:probSolEj} mediante el modelo de flujo de mercancía mostrado en la sección \ref{sec:models} con variables binarias $x_{ij}$, con valor 1 cuando el cliente $j$ se visita justo después que el cliente $i$, y variables de flujo $y_{ij}$ y $y_{ji}$, se obtendría el conjunto de instancias de variables $v_j$ siguiente:

% \begin{figure}[h!]
% 	\centering
% \begin{minipage}{0.45\textwidth}
% 	$x$ = $\left(\begin{array}{ccccc}
% 	0 & 1 & 0 & 1 & 0 \\
% 	0 & 0 & 1 & 0 & 0 \\
% 	0 & 0 & 0 & 0 & 1 \\
% 	0 & 0 & 0 & 0 & 1 \\
% 	0 & 0 & 0 & 0 & 0 \\
% 	\end{array}\right)$
% \end{minipage}
% \hfill \begin{minipage}{0.45\textwidth}
% 	$y$ = $\left(\begin{array}{ccccc}
% 	0 & 3 & 0 & 1 & 0 \\
% 	0 & 0 & 2 & 0 & 0 \\
% 	0 & 1 & 0 & 0 & 0 \\
% 	2 & 0 & 0 & 0 & 0 \\
% 	0 & 0 & 3 & 3 & 0 \\
% 	\end{array}\right)$
% \end{minipage}
% \caption{Conjunto de instancias de variables $v_j$}\label{fig:varEj}
% \end{figure}

% El conjunto de instancias de parámetros $p_j$ en el modelo se muestran en la figura \ref{fig:paramEj}.

% \begin{figure}[h!]
% 	\centering
% 	$n = 3$
	
% 	$K = 2$
	
% 	$C = 3$
	
% 	$d = (1,\ 2,\ 3)$
%         \caption{Conjunto de instancias de parámetros $p_j$}
%         \label{fig:paramEj}
% \end{figure}

% Por último, el conjunto de instancias de los conjuntos $c_j$ estaría formado por un único elemento como ilustra la figura \ref{fig:setEj}.

% \begin{figure}[h!]
% 	\centering
% 	$V = \{0,\ 1,\ 2,\ 3,\ 4\}$
%     \caption{Instancia de conjuntos $c_j$}
% 	\label{fig:setEj}
% \end{figure}

% Los valores 1, 2 y 3 representan a los clientes y 0 y 4 representan al depósito central dado que en esta formulación se agrega un nodo ficticio para el almacén.

% Con este proceso se puede transformar cualquier solución de alto nivel en la solución de bajo nivel correspondiente para verificar la validez de las restricciones en el modelo.

% Las soluciones de bajo nivel se pasan como argumentos a las restricciones del modelo. La sección siguiente describe el tercer componente del sistema propuesto en el que, por cada restricción del modelo, se genera una función. Este componente recibe el nombre de generador de funciones.

% \section{Generador de funciones}\label{sec:third}
% El generador de funciones, como su nombre lo indica, genera funciones evaluables a partir de las restricciones del problema. Para ello recibe los conjuntos de instancias de parámetros $p_j$ y de conjuntos $c_j$ obtenidos a partir de la instancia $P_j$, y transforma la restricción de acuerdo a dicha instancia. Esta función tiene como entrada las variables del modelo y devuelve un valor indicando si la solución satisface o no esa restricción. Los valores de las variables, los parámetros y los conjuntos se obtienen en el generador de soluciones de bajo nivel. Por ejemplo, para la restricción:

% \begin{equation}\label{cons:wrong}
% y_{ij} + y_{ji} = C x_{ij}\ \ \forall (i, j) \in A
% \end{equation}

% presente en el modelo de CVRP por flujo de mercancías definido en \ref{sec:models}, se generaría la función

% $$
% f(x, y) = \left\{ \begin{array}{cl}
% 1 & si\ y_{ij} + y_{ji} = C x_{ij}\ \ \forall (i, j) \in A\\
% 0 & en\ otro\ caso
% \end{array}\right.
% $$.

% Con los valores de las variables del modelo y las funciones correspondientes a cada restricción obtenidos en el generador de soluciones de bajo nivel y en el generador de funciones, respectivamente, es posible validar el modelo. En la siguiente sección se describe el funcionamiento del último componente donde ocurre el proceso de validación: el evaluador del modelo.

% \section{Evaluador del modelo}\label{sec:fourth}
% En este último componente, cada una de las instancias de variables del modelo se evalúa en las funciones generadas en el tercer componente para la instancia de problema $P_j$. Después de la evaluación, en aras de validar el modelo, es necesario comprobar si todas las características en $C_i$ se satisfacen para todos los pares $(S_j, P_j)$ y si todas las características en $C_i^c$ se incumplen. Si una de esas dos verificaciones falla, entonces el modelo está incorrecto. De lo contrario, se selecciona la próxima partición $(C_{i+1}, C_{i+1}^c)$ y se repite el proceso.

% Si en cada prueba ningún requerimiento se incumple, entonces el modelo parece estar correcto porque todas las condiciones impuestas a las soluciones han sido cumplidas por las restricciones del modelo. De lo contrario, se puede asegurar que el modelo está incorrecto y se muestran ejemplos que ilustran lo anterior. Por ejemplo, si la solución factible definida en la sección \ref{sec:first}, cuyos valores para las variables se muestran en la sección \ref{sec:second}, se evaluara en cada una de las funciones generadas en el componente descrito en la sección \ref{sec:third}, entonces los resultados de todas las evaluaciones en las restricciones deberían ser positivos porque la solución es factible. Si ocurriera lo contrario, entonces se puede afirmar que el modelo está incorrecto.

% Una vez presentado el funcionamiento del sistema propuesto en este trabajo, es posible describir los detalles de la implementación. El siguiente capítulo abordará este aspecto.
